# --- Core System Configuration ---
# 
# This file stores the measured drift rate of the system clock.
# DO NOT CHANGE: Required for stability across reboots.
driftfile /var/lib/chrony/chrony.drift

# Set the initial step/slew policy. This directive is CRITICAL for system stability.
# makestep 1 3: Step the clock immediately (unsafe jump) IF the adjustment is 
# larger than 1 second, BUT ONLY during the first 3 updates after startup.
# After that, it ONLY USES SAFE SLEWING. This prevents the large jumps that 
# caused your system services (like journald) to fail.
makestep 1 3

# Synchronise the hardware Real Time Clock (RTC) with the system clock.
# If your device has an RTC, this ensures the time is retained across power loss.
rtcsync

# --- GPSD Reference Clock Configuration ---
# 
# The refclock directive tells chrony to read time from a hardware reference source.
# 
# SHM 0: GPS Time (NMEA data) via Shared Memory. This provides the date and time.
refclock SHM 0 refid GPS precision 1e-1

# SHM 1: Pulse Per Second (PPS) signal via Shared Memory. This provides
# highly accurate timing for the *second* mark, if your GPS hardware supports PPS.
# Use only if you have configured gpsd to provide the PPS signal (e.g., via GPIO).
# If you are unsure, you can comment this out or use 'noselect' until verified.
# refclock SHM 1 refid PPS precision 1e-7 minsources 1 noselect
